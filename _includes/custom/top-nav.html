<!-- The Top Navigation Bar -->

<div id="top-nav" aria-label="Top Navigation">
  <div class="profile-wrapper">
    <a href="{{ '/' | relative_url }}" id="avatar" class="rounded-circle">
      {%- if site.avatar != empty and site.avatar -%}
        {%- capture avatar_url -%}
          {% include media-url.html src=site.avatar %}
        {%- endcapture -%}
        <img src="{{- avatar_url -}}" alt="avatar" onerror="this.style.display='none'">
      {%- endif -%}
    </a>

    <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
  </div>

  <!-- Hamburger menu toggle for mobile -->
  <button type="button" class="menu-toggle" aria-label="Toggle Menu">
    <i class="fas fa-bars"></i>
  </button>

  <nav class="nav">
    <!-- home -->
    <li class="nav-item{% if page.layout == 'home' %}{{ " active" }}{% endif %}">
      <a href="{{ '/' | relative_url }}" class="nav-link">
        <i class="fa-fw fas fa-home"></i>
        <span>{{ site.data.locales[include.lang].tabs.home | default: "Home" }}</span>
      </a>
    </li>
    <!-- the real tabs -->
    {% for tab in site.tabs %}
      <li class="nav-item{% if tab.url == page.url %}{{ " active" }}{% endif %}">
        <a href="{{ tab.url | relative_url }}" class="nav-link">
          <i class="fa-fw {{ tab.icon }}"></i>
          {% capture tab_name %}{{ tab.url | split: '/' | last }}{% endcapture %}

          <span>{{ site.data.locales[include.lang].tabs[tab_name] | default: tab.title }}</span>
        </a>
      </li>
    {% endfor %}

    <!-- Toggle theme mode -->
    {% unless site.theme_mode %}
      <li class="nav-item">
        <button type="button" class="btn nav-link" aria-label="Switch Mode" id="mode-toggle">
          <i class="fas fa-adjust"></i>
        </button>
      </li>
    {% endunless %}
  </nav>
</div>

<div id="search-wrapper">
  <search id="search" class="d-flex align-items-center">
    <i class="fas fa-search fa-fw"></i>
    <input
      class="form-control"
      id="search-input"
      type="search"
      aria-label="search"
      autocomplete="off"
      placeholder="{{ site.data.locales[include.lang].search.hint | default: 'Search' | capitalize }}..."
    >
  </search>
</div>

<!-- Mobile menu functionality with better touch support -->
<script>
  (function() {
    var navbar = document.getElementById('top-nav');
    var menuToggle = document.querySelector('.menu-toggle');
    
    // Mobile menu toggle with improved touch handling
    if (menuToggle) {
      // Use touchstart for mobile devices for better responsiveness
      menuToggle.addEventListener('touchstart', handleMenuToggle, {passive: false});
      // Also keep click for desktop testing and accessibility
      menuToggle.addEventListener('click', handleMenuToggle);
    }
    
    function handleMenuToggle(e) {
      e.preventDefault();
      e.stopPropagation();
      navbar.classList.toggle('menu-active');
    }
    
    // Close menu when clicking/touching elsewhere
    document.addEventListener('touchstart', handleOutsideClick, {passive: true});
    document.addEventListener('click', handleOutsideClick);
    
    function handleOutsideClick(e) {
      if (!navbar.classList.contains('menu-active')) return;
      
      // Close if click outside menu or on a nav link
      var targetEl = e.target;
      if (!navbar.contains(targetEl) || targetEl.closest('.nav-link')) {
        navbar.classList.remove('menu-active');
      }
    }
    
    // Navbar visibility on scroll
    var lastScrollTop = 0;
    var delta = 5;
    var navbarHeight = navbar.offsetHeight;
    var showThreshold = 100;
    
    window.addEventListener('scroll', function() {
      var st = window.pageYOffset || document.documentElement.scrollTop;
      
      if (Math.abs(lastScrollTop - st) <= delta) return;
      
      if (st > showThreshold) {
        navbar.classList.add('nav-up');
      } else {
        navbar.classList.remove('nav-up');
      }
      
      lastScrollTop = st;
    });
  })();
</script>